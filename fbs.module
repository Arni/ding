<?php

/**
 * Implements hook_ding_provider().
 */
function fbs_ding_provider() {
  $path = drupal_get_path('module', 'fbs');

  return array(
    'title' => 'FBS provider',
    //'settings' => 'fbs_settings_form',
    'provides' => array(
      'availability' => array(
        'prefix' => 'availability',
        'file' => $path . '/includes/fbs.availability.inc',
      ),
      // 'debt' => array(
      //   'prefix' => 'debt',
      //   'file' => $path . '/includes/fbs.debt.inc',
      // ),
      // 'loan' => array(
      //   'prefix' => 'loan',
      //   'file' => $path . '/includes/fbs.loan.inc',
      // ),
      // 'reservation' => array(
      //   'prefix' => 'reservation',
      //   'file' => $path . '/includes/fbs.reservation.inc',
      // ),
      'user' => array(
        'prefix' => 'user',
        'file' => $path . '/includes/fbs.user.inc',
      ),
      // 'wayf' => array(
      //   'prefix' => 'wayf',
      //   'file' => $path . '/includes/fbs.wayf.inc',
      // ),
    ),
  );
}

/**
 * Get the service object.
 *
 * Parameters is for injecting in tests. Don't use.
 */
function fbs_service($agency_id = NULL, $endpoint = NULL, $client = NULL, $mapper = NULL, $reset = FALSE) {
  // No drupal_static. We want to be callable from tests.
  static $service;
  if (!$service || $reset) {
    $agency_id = !is_null($agency_id) ? $agency_id : variable_get('fbs_agency_id', '');
    $endpoint = !is_null($endpoint) ? $endpoint : variable_get('fbs_endpoint', '');
    $service = new FBS($agency_id, $endpoint, $client, $mapper);
  }
  return $service;
}

function fbs_patron_id($user = NULL) {
    // throw DingProviderAuthException if no user is logged in.
}
