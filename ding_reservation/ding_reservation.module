<?php

/**
 * Implementation of hook_menu().
 */
function ding_reservation_menu() {
  $items = array();

  $items['ding/reserve/%'] = array(
    'title' => 'Reserve item',
    'page callback' => 'ding_reservation_page_reserve_item',
    'page arguments' => array(3),
    'access arguments' => array('access content'),
    'file' => 'ding_reservation.pages.inc',
    'type' => MENU_CALLBACK,
  );
  
  return $items;
}

/**
 * Implementation of hook_requirements().
 */
function ding_reservation_requirements($phase) {
  $ret = array();
  
  if ($phase == 'runtime') {
    // Check whether any modules will support reservations.
    $reservation_hooks = array( 'ding_library_user_create_reservation' => t('creating'), 
                                'ding_library_user_update_reservation' => t('updating'), 
                                'ding_library_user_delete_reservation' => t('deleting'),
                                'ding_library_user_get_reservations' => t('listing'),
                                'ding_library_user_has_reservation' => t('checking for'));

    $supported_actions = array();
    $missing_actions = array();
    foreach ($reservation_hooks as $hook => $action_text) {
      if (count(module_implements($hook)) > 0) {
        $supported_actions[] = $action_text;
      } else {
        $missing_actions[] = $action_text;
      }
    }
    
    if (sizeof($missing_actions) > 0) {
      // Not all hooks are supported. Report a warning.
      $warning = array();
      $warning['title'] = t('Ding reservation');
      $warning['severity'] = REQUIREMENT_WARNING;
      $warning['value'] = t('Supported actions: @actions', array('@actions' => implode(', ', $supported_actions)));
      $warning['description'] = t('No enabled modules support @actions reservations.', array('@actions' => implode(', ', $missing_actions)));

      $ret[] = $warning;
    }
  }
  
  return $ret;
}

